<!DOCTYPE html>
<html>
<head>
    <title>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∫–æ—Ä–∞–±–ª–µ–π</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='main.css') }}">
</head>
<body>
    <div class="header">
        <h1>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –∫–æ—Ä–∞–±–ª—è</h1>
        <div>
            –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: {{ session.user_id }} | –†–æ–ª—å: {{ session.user_group }} |
            <a href="{{ url_for('main_menu') }}">–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</a> |
            <a href="{{ url_for('menu_exit') }}">–í—ã–π—Ç–∏</a>
        </div>
    </div>

    <div class="content">
        <div class="form-container">
            <h2>–î–æ–±–∞–≤–∏—Ç—å –∫–æ—Ä–∞–±–ª—å –≤ –∫–æ—Ä–∑–∏–Ω—É</h2>

            <form method="POST" action="{{ url_for('bp_registration.add_to_registration') }}">
                <div class="form-group">
                    <label for="ship_name">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ—Ä–∞–±–ª—è:</label>
                    <input type="text" id="ship_name" name="ship_name" required
                           placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ—Ä–∞–±–ª—è">
                </div>

                <div class="form-group">
                    <label for="ship_type_id">–¢–∏–ø –∫–æ—Ä–∞–±–ª—è:</label>
                    <select id="ship_type_id" name="ship_type_id" required>
                        <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø --</option>
                        {% for ship_type in ship_types %}
                            <option value="{{ ship_type.id }}">{{ ship_type.type_name }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="form-group">
                    <label for="tonnage">–í–æ–¥–æ–∏–∑–º–µ—â–µ–Ω–∏–µ (—Ç–æ–Ω–Ω):</label>
                    <input type="number" id="tonnage" name="tonnage" step="0.01" min="1" required
                           placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 50000">
                </div>

                <div class="form-group">
                    <label for="home_port">–î–æ–º–∞—à–Ω–∏–π –ø–æ—Ä—Ç:</label>
                    <select id="home_port" name="home_port" required>
                        <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –ø–æ—Ä—Ç --</option>
                        {% for port in ports %}
                            <option value="{{ port.home_port }}">{{ port.home_port }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="form-group">
                    <label for="team_id">–ë—Ä–∏–≥–∞–¥–∞ –¥–ª—è —Ä–∞–∑–≥—Ä—É–∑–∫–∏:</label>
                    <select id="team_id" name="team_id" required>
                        <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –±—Ä–∏–≥–∞–¥—É --</option>
                        {% for team in teams %}
                            <option value="{{ team.id }}">
                                {{ team.team_name }} ({{ team.member_count }} —á–µ–ª.)
                            </option>
                        {% endfor %}
                    </select>
                    {% if teams %}
                        <div class="team-details" style="margin-top: 10px; font-size: 0.9em; color: #666;">
                            <strong>–°–æ—Å—Ç–∞–≤ –±—Ä–∏–≥–∞–¥:</strong>
                            <ul style="margin: 5px 0; padding-left: 20px;">
                                {% for team in teams %}
                                    <li><strong>{{ team.team_name }}:</strong> {{ team.team_members }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                    {% endif %}
                </div>

                <div class="form-group">
                    <label for="berth_id">–ü—Ä–∏—á–∞–ª (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):</label>
                    <select id="berth_id" name="berth_id">
                        <option value="">-- –ë–µ–∑ –ø—Ä–∏—á–∞–ª–∞ --</option>
                        {% for berth in berths %}
                            {% if berth.status == '–°–≤–æ–±–æ–¥–µ–Ω' %}
                            <option value="{{ berth.id }}">
                                –ü—Ä–∏—á–∞–ª {{ berth.id }} ({{ berth.berth_type }}, {{ berth.length }}–º)
                            </option>
                            {% endif %}
                        {% endfor %}
                    </select>
                    <small style="display: block; margin-top: 5px; color: #666;">
                        –î–æ—Å—Ç—É–ø–Ω–æ –ø—Ä–∏—á–∞–ª–æ–≤: {{ berths|selectattr('status', 'equalto', '–°–≤–æ–±–æ–¥–µ–Ω')|list|length }}
                    </small>
                </div>

                <button type="submit" class="btn-primary">–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É</button>
            </form>

            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    <div class="flash-messages">
                        {% for category, message in messages %}
                            <div class="alert alert-{{ category }}">
                                {{ message }}
                            </div>
                        {% endfor %}
                    </div>
                {% endif %}
            {% endwith %}
        </div>

        <div class="cart-container" style="margin-top: 30px;">
            <h2>–ö–æ—Ä–∑–∏–Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</h2>

            {% if cart %}
                <table class="cart-table">
                    <thead>
                        <tr>
                            <th>‚Ññ</th>
                            <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                            <th>–¢–∏–ø</th>
                            <th>–í–æ–¥–æ–∏–∑–º–µ—â–µ–Ω–∏–µ</th>
                            <th>–ü–æ—Ä—Ç</th>
                            <th>–ë—Ä–∏–≥–∞–¥–∞</th>
                            <th>–ü—Ä–∏—á–∞–ª</th>
                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item_id, ship_data in cart.items() %}
                        <tr>
                            <td>{{ loop.index }}</td>
                            <td>{{ ship_data.ship_name }}</td>
                            <td>
                                {% for ship_type in ship_types %}
                                    {% if ship_type.id|string == ship_data.ship_type_id %}
                                        {{ ship_type.type_name }}
                                    {% endif %}
                                {% endfor %}
                            </td>
                            <td>{{ ship_data.tonnage }} —Ç</td>
                            <td>{{ ship_data.home_port }}</td>
                            <td>
                                {% for team in teams %}
                                    {% if team.id|string == ship_data.team_id %}
                                        {{ team.team_name }}
                                    {% endif %}
                                {% endfor %}
                            </td>
                            <td>
                                {% if ship_data.berth_id %}
                                    {% for berth in berths %}
                                        {% if berth.id|string == ship_data.berth_id %}
                                            –ü—Ä–∏—á–∞–ª {{ berth.id }}
                                        {% endif %}
                                    {% endfor %}
                                {% else %}
                                    ‚Äî
                                {% endif %}
                            </td>
                            <td>
                                <form method="POST"
                                      action="{{ url_for('bp_registration.remove_from_registration', cart_item_id=item_id) }}"
                                      style="display: inline;">
                                    <button type="submit" class="btn-danger btn-small">
                                        –£–¥–∞–ª–∏—Ç—å
                                    </button>
                                </form>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>

                <div class="cart-actions" style="margin-top: 20px;">
                    <form method="POST"
                          action="{{ url_for('bp_registration.clear_registration') }}"
                          style="display: inline-block; margin-right: 15px;">
                        <button type="submit" class="btn-danger">
                            –û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É
                        </button>
                    </form>

                    <form method="POST"
                          action="{{ url_for('bp_registration.submit_registration') }}"
                          style="display: inline-block;">
                        <button type="submit" class="btn-success">
                            –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –∫–æ—Ä–∞–±–ª–∏ ({{ cart|length }})
                        </button>
                    </form>
                </div>
            {% else %}
                <div class="empty-cart" style="text-align: center; padding: 20px; background: #f8f9fa; border-radius: 5px;">
                    <p style="color: #666; font-size: 1.1em;">
                        –ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞. –î–æ–±–∞–≤—å—Ç–µ –∫–æ—Ä–∞–±–ª–∏ —Å –ø–æ–º–æ—â—å—é —Ñ–æ—Ä–º—ã –≤—ã—à–µ.
                    </p>
                </div>
            {% endif %}
        </div>

        <div class="navigation-links" style="margin-top: 30px; text-align: center;">
            <a href="{{ url_for('bp_registration.active_ships') }}" class="btn">
                üìã –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ —Ä–∞–∑–≥—Ä—É–∑–∫–∏
            </a>
            <a href="{{ url_for('bp_registration.ship_history') }}" class="btn">
                üìä –ò—Å—Ç–æ—Ä–∏—è –∫–æ—Ä–∞–±–ª–µ–π
            </a>
            <a href="{{ url_for('main_menu') }}" class="btn">
                üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
            </a>
        </div>
    </div>
</body>
</html>